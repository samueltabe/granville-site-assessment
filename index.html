<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/img/icon.png" type="image/x-icon">
    <title>Granville Energy | Field Assessment Tool</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo-area">
            <a href="/">
                <img src="img/logoblack.png" alt="">
            </a>
        </div>
        <div style="font-size: 0.7rem; font-weight: 600; color: var(--text-light);">
            OFFICIAL SITE ASSESSMENT v2.0
        </div>
    </div>

    <div class="stepper">
        <div class="step active" id="s1">
            <div class="step-circle">1</div>
            <span>CLIENT & SUPPLY</span>
        </div>
        <div class="step" id="s2">
            <div class="step-circle">2</div>
            <span>ENERGY & LOAD</span>
        </div>
        <div class="step" id="s3">
            <div class="step-circle">3</div>
            <span>TECHNICAL SITE</span>
        </div>
    </div>
    
    <form id="assessmentForm" action="https://formspree.io/f/xjgyrgpg" method="POST">
    <div class="content-card">
        
        <div class="page active" id="p1">
            <div class="section-header">
                <h2><i data-lucide="user-check"></i> Project & Client Info</h2>
                <p>Enter primary contact and site location details.</p>
            </div>
            
            <div class="input-grid">
                <div>
                    <label class="field-label">Lead Engineer</label>
                    <input type="text" name="lead_engineer" placeholder="Full Name">
                </div>
                <div>
                    <label class="field-label">Assessment Date</label>
                    <input type="date" name="assessment_date">
                </div>
                <div class="full-width">
                    <label class="field-label">Client / Company Name</label>
                    <input type="text" name="client_name" placeholder="Entity name as per utility bill">
                </div>
                <div class="full-width">
                    <label class="field-label">Site Address</label>
                    <input type="text" name="site_address" placeholder="Physical address for installation">
                </div>
            </div>

            <div class="section-header">
                <h2><i data-lucide="zap"></i> Connection Details</h2>
                <p>Understanding the current utility environment.</p>
            </div>
            <div class="input-grid">
                <div>
                    <label class="field-label">Supply Configuration</label>
                    <select name="supply_config">
                        <option>Single Phase</option>
                        <option>Three Phase</option>
                    </select>
                </div>
                <div>
                    <label class="field-label">Meter Type</label>
                    <select name="meter_type">
                        <option>Prepaid</option>
                        <option>Postpaid</option>
                        <option>Smart Meter</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="page" id="p2">
            <div class="section-header">
                <h2><i data-lucide="bar-chart-3"></i> Consumption Profile</h2>
                <p>Historical energy data used for system sizing.</p>
            </div>

            <div class="input-grid">
                <div>
                    <label class="field-label">Avg. Monthly kWh</label>
                    <input type="number" name="monthly_kwh" placeholder="0.00">
                </div>
                <div>
                    <label class="field-label">Avg. Monthly Spend ($)</label>
                    <input type="number" name="monthly_spend" placeholder="0.00">
                </div>
                <div class="full-width">
                    <label class="field-label">Primary Objective</label>
                    <div class="option-grid">
                        <label class="option-card"><input type="radio" name="objective" value="Bill Savings"> Bill Savings</label>
                        <label class="option-card"><input type="radio" name="objective" value="Backup Power"> Backup Power</label>
                        <label class="option-card"><input type="radio" name="objective" value="Full Off-Grid"> Full Off-Grid</label>
                    </div>
                </div>
            </div>

            <div class="section-header">
                <h2><i data-lucide="activity"></i> High-Surge Loads</h2>
                <p>Identify equipment requiring high starting currents.</p>
            </div>
            <div class="option-grid">
                <label class="option-card"><input type="checkbox" name="load_borehole"> Borehole Pump</label>
                <label class="option-card"><input type="checkbox" name="load_ac"> Air Conditioning</label>
                <label class="option-card"><input type="checkbox" name="load_cold_storage"> Cold Storage</label>
                <label class="option-card"><input type="checkbox" name="load_server"> Server Infrastructure</label>
                <label class="option-card"><input type="checkbox" name="load_fence"> Electric Fence</label>
                <label class="option-card"><input type="checkbox" name="load_workshop"> Workshop Gear</label>
            </div>
        </div>

        <div class="page" id="p3">
            <div class="section-header">
                <h2><i data-lucide="factory"></i> Infrastructure & Roof</h2>
                <p>Physical constraints and installation planning.</p>
            </div>

            <div class="input-grid">
                <div>
                    <label class="field-label">Roof Material</label>
                    <select name="roof_material">
                        <option>IBR / Metal</option>
                        <option>Tile</option>
                        <option>Concrete Flat</option>
                        <option>Ground Mount</option>
                    </select>
                </div>
                <div>
                    <label class="field-label">Orientation</label>
                    <select name="orientation">
                        <option>North</option>
                        <option>East / West</option>
                        <option>South</option>
                    </select>
                </div>
                <div>
                    <label class="field-label">Main Breaker (Amps)</label>
                    <input type="text" name="breaker_amps" placeholder="e.g. 60A">
                </div>
                <div>
                    <label class="field-label">Cable Distance (m)</label>
                    <input type="number" name="cable_distance" placeholder="PV to Inverter">
                </div>
            </div>

            <div class="section-header">
                <h2><i data-lucide="camera"></i> Photo Checklist</h2>
                <p>Standardized evidence required for design sign-off.</p>
            </div>
            <div class="option-grid">
                <label class="option-card"><input type="checkbox" name="photo_db"> Main DB Open</label>
                <label class="option-card"><input type="checkbox" name="photo_roof"> Roof Conditions</label>
                <label class="option-card"><input type="checkbox" name="photo_meter"> Utility Meter</label>
                <label class="option-card"><input type="checkbox" name="photo_placement"> Placement Area</label>
            </div>
            
            <div style="margin-top: 30px;">
                <label class="field-label">Special Engineering Notes</label>
                <textarea name="eng_notes" rows="4" placeholder="Note any shading risks or structural concerns..."></textarea>
            </div>

            <input type="text" name="_gotcha" style="display:none">
        </div>

        <div class="footer-nav">
            <button type="button" class="btn btn-secondary hidden" id="prevBtn" onclick="movePage(-1)">
                <i data-lucide="chevron-left"></i> Previous
            </button>
            <button type="button" class="btn btn-primary" id="nextBtn" onclick="handleNextClick()">
                Next Step <i data-lucide="chevron-right"></i>
            </button>
        </div>
    </div>
</form>


    
</div>

<script src="script.js"></script>

<!-- Start of HubSpot Embed Code -->
<!-- <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/8605810.js"></script> -->
<!-- End of HubSpot Embed Code -->
<script>
    const originalMovePage = window.movePage;
    
    window.movePage = function(delta) {
        let currentStep = parseInt(document.querySelector('.page.active').id.charAt(1));
        
        // Trigger on the final step
        if (currentStep + delta > 3) {
            const form = document.getElementById('siteAssessment');
            const formData = new FormData(form);
            
            // Map your HTML names to HubSpot Property Internal Names
            const fields = [];
            for (let [key, value] of formData.entries()) {
                fields.push({
                    "objectTypeId": "0-1", 
                    "name": key, 
                    "value": value
                });
            }

            const payload = {
                "fields": fields,
                "context": {
                    "pageUri": window.location.href,
                    "pageName": document.title
                }
            };

            // YOUR PORTAL ID: 8605810 (from your screenshot)
            // Replace YOUR_FORM_GUID with the ID from your HubSpot Form settings
            fetch('https://api.hsforms.com/submissions/v3/integration/submit/8605810/YOUR_FORM_GUID', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(res => {
                if(res.ok) {
                    alert("Success! Data sent to HubSpot.");
                    location.reload();
                } else {
                    alert("Submission failed. Ensure your 'name' attributes match HubSpot internal names.");
                }
            });
            
            return;
        }
        originalMovePage(delta);
    };
</script> 
</body>
</html>